<!--
  View: ClassStudentReport
  Used by: GET /classStudentReport/:name/:user_id/:class_id via studentsController.getClassStudentByName.
  Expects template locals: //csrfToken, class_id, competencies, progressData, student_name, title.
  Primary data variables used in this template: class_id, completed, counter, csrfToken, domain, item, pct, progressData, title, total.
-->

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- Uses the dynamic page title set by the controller. -->
  <title><%= title %> - CS346 Project</title>
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>
  <header>
    <nav>
      <div class="container">
        <a href="/" class="logo">Titan Care Tracker</a>
        <ul class="nav-links">
          <li><a href="/">Home</a></li>
          <li><a href="/about">About</a></li>
<!-- Conditional block: Show user-specific section only when a user is logged in. (condition: `user`). -->
          <% if (user) { %>
            <li><a href="/users/profile">Profile</a></li>
            <li>
              <form action="/users/logout" method="POST" style="display: inline;">
                <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                <button type="submit" class="btn-link">Logout</button>
              </form>
            </li>
          <% } else { %>
            <li><a href="/users/login">Login</a></li>
            <li><a href="/users/register">Register</a></li>
          <% } %>
        </ul>
      </div>
    </nav>
  </header>

  <main class="container">

    <section class="features">
      <h1>Student Report</h1>

<!-- Conditional block: Show this section only when the condition is true. (condition: `progressData`). -->
      <% if (progressData) {
          const total = Math.max(1, Number(progressData.total || 0)); // avoid /0
          const completed = Number(progressData.completed || 0);
          const pct = Math.round((completed / total) * 100);
      %>
        <section class="progress-widget" aria-labelledby="progress-title">
          <h3 id="progress-title" class="progress-title"><%= progressData.fullName %></h3>

          <div class="progress-meta">
            <span class="progress-label"><%= progressData.progressLabel %> competencies demonstrated.</span>
          </div>

          <progress
            class="progress-bar"
            max="<%= total %>"
            value="<%= completed %>"
            aria-valuemin="0"
            aria-valuemax="<%= total %>"
            aria-valuenow="<%= completed %>"
            aria-label="<%= progressData.progressLabel %>">
              <%= pct %>%   <!-- fallback text for very old browsers -->
          </progress>
        </section>
      <% } %>
        <% let counter = 1; %>
        <% competencies.forEach(domain => { %>
          <div class="domain">
            <h2><%= domain.domain %></h2>
            <% domain.competencies.forEach(item => { %>
              <div class="competency">
                <input
                  type="checkbox"
                  id="comp<%= counter %>"
                  <%= item.complete ? 'checked' : '' %>
                  disabled
                >
                <label for="comp<%= counter %>">
                  <%= counter %>. <%= item.text %>
                </label>
              </div>
              <% counter++; %>
            <% }) %>
          </div>
        <% }) %>
    </section>

    <a href="/classes/class_report/<%= class_id %>" class="features">‚Üê Back to Class Report</a>
  </main>

  <footer>
    <div class="container">
      <p>&copy; 2024 CS346 Project. All rights reserved.</p>
    </div>
  </footer>

  <script src="/js/main.js"></script>
</body>
</html>
